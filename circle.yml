machine:
  services:
    - docker
    - mongodb

dependencies:
  cache_directories:
    - "~/docker"
  pre:
    - docker info && docker version
    - "docker build -t sample_node_mongo:$CIRCLE_SHA1 ~/sample_node_mongo/."
    - "rm -rf ~/sample_node_mongo"

deployment:
  prod:
    branch: master
    commands:
      - docker login -e docker@flowics.com -u docker -p 123456 monitor.flowics.com:5000/sample_node_mongo
      - docker push sample_node_mongo:$CIRCLE_SHA1 monitor.flowics.com:5000/sample_node_mongo:$CIRCLE_SHA1
