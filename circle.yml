machine:
  node:
    version: 0.12

  services:
    - docker
    - mongodb

dependencies:
  cache_directories:
    - "~/docker"

  pre:
    - docker info && docker version
    - "docker build -t sample_node_mongo:latest ~/sample_node_mongo/."
 
test:
  override:
    - docker run -d -p80:3000 sample_node_mongo

deployment:
  prod:
    branch: master
    commands:
      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS $EXTERNAL_REGISTRY_ENDPOINT
      - docker push
